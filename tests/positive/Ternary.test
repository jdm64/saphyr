
struct S
{
	int a, b;
}

int four()
{
	S z;
	return 4? 5 : z.a;
}

int func()
{
	int x = 4;
	return x > 3? func() : four(); 
}

int main()
{
	int x = 5;

	auto f = x < 10? 1.0 : 3.5;
	auto z = f > 10? 4 + f : x + 1.0;

	return z;
}

========

%S = type { i32, i32 }

define i32 @four() {
  %z = alloca %S
  br i1 true, label %4, label %1

; <label>:1:                                      ; preds = %0
  %2 = getelementptr %S, %S* %z, i32 0, i32 0
  %3 = load i32, i32* %2
  br label %4

; <label>:4:                                      ; preds = %0, %1
  %5 = phi i32 [ %3, %1 ], [ 5, %0 ]
  ret i32 %5
}

define i32 @func() {
  %x = alloca i32
  store i32 4, i32* %x
  %1 = load i32, i32* %x
  %2 = icmp sgt i32 %1, 3
  br i1 %2, label %3, label %5

; <label>:3:                                      ; preds = %0
  %4 = call i32 @func()
  br label %7

; <label>:5:                                      ; preds = %0
  %6 = call i32 @four()
  br label %7

; <label>:7:                                      ; preds = %5, %3
  %8 = phi i32 [ %4, %3 ], [ %6, %5 ]
  ret i32 %8
}

define i32 @main() {
  %x = alloca i32
  store i32 5, i32* %x
  %1 = load i32, i32* %x
  %2 = icmp slt i32 %1, 10
  %3 = select i1 %2, double 1.000000e+00, double 3.500000e+00
  %f = alloca double
  store double %3, double* %f
  %4 = load double, double* %f
  %5 = fcmp ogt double %4, 1.000000e+01
  br i1 %5, label %6, label %9

; <label>:6:                                      ; preds = %0
  %7 = load double, double* %f
  %8 = fadd double 4.000000e+00, %7
  br label %13

; <label>:9:                                      ; preds = %0
  %10 = load i32, i32* %x
  %11 = sitofp i32 %10 to double
  %12 = fadd double %11, 1.000000e+00
  br label %13

; <label>:13:                                     ; preds = %9, %6
  %14 = phi double [ %8, %6 ], [ %12, %9 ]
  %z = alloca double
  store double %14, double* %z
  %15 = load double, double* %z
  %16 = fptosi double %15 to i32
  ret i32 %16
}

========

four T
func T
main T
